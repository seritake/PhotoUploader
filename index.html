<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="//sdk.amazonaws.com/js/aws-sdk-2.1.34.min.js"></script>


<input type="file" name="upload" id="upload-file">
<a href="javascript:void(0)" id="apply-upload">アップロード</a>

<script>
    $(function() {
        var s3_client = function () {
            AWS.config.region = "us-east-1";
            AWS.config.credentials = new AWS.CognitoIdentityCredentials({IdentityPoolId: "us-east-1:931d3d0b-6093-4852-b65c-9676aa85e17c"});
            AWS.config.credentials.get(function (err) {
                if (!err) {
                    console.log("Cognito Identify Id: " + AWS.config.credentials.identityId);
                }
            });
            return new AWS.S3({params: {Bucket: "photouploaderforet"}});
        };

        $("#apply-upload").click(function () {
            var file = $("#upload-file").prop("files")[0];
            var timestamp = new Date().getTime();
            var filename = "file" + timestamp + ".png";
            s3_client().putObject({Key: filename, ContentType: file.type, Body: file, ACL: "public-read"},
                function (err, data) {
                    // if failed, alert
                    if (data !== null) {
                        alert("アップロード成功!");
                    } else {
                        alert("アップロード失敗.");
                    }
                });
        });
    });
</script>